{% extends "base.html" %}
{% block title %}Products — Forge Commerce{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Products</h1>
</div>

<div class="catalog-layout">
    <aside class="catalog-sidebar">
        <h3>Categories</h3>
        <a href="/products" class="filter-link {% if current_category == '' %}active{% endif %}">All</a>
        {% for cat in categories %}
        <a href="/products?category={{ cat.name | urlencode }}&sort={{ current_sort }}"
           class="filter-link {% if current_category == cat.name %}active{% endif %}"
           hx-get="/products/search?category={{ cat.name | urlencode }}&sort={{ current_sort }}"
           hx-target="#search-results"
           hx-push-url="/products?category={{ cat.name | urlencode }}&sort={{ current_sort }}">
            {{ cat.name }} <span class="count">({{ cat.count }})</span>
        </a>
        {% endfor %}

        <h3>Sort By</h3>
        <a href="/products?category={{ current_category | urlencode }}&sort=newest"
           class="filter-link {% if current_sort == '' or current_sort == 'newest' %}active{% endif %}"
           hx-get="/products/search?category={{ current_category | urlencode }}&sort=newest"
           hx-target="#search-results">Newest</a>
        <a href="/products?category={{ current_category | urlencode }}&sort=price_asc"
           class="filter-link {% if current_sort == 'price_asc' %}active{% endif %}"
           hx-get="/products/search?category={{ current_category | urlencode }}&sort=price_asc"
           hx-target="#search-results">Price: Low → High</a>
        <a href="/products?category={{ current_category | urlencode }}&sort=price_desc"
           class="filter-link {% if current_sort == 'price_desc' %}active{% endif %}"
           hx-get="/products/search?category={{ current_category | urlencode }}&sort=price_desc"
           hx-target="#search-results">Price: High → Low</a>
        <a href="/products?category={{ current_category | urlencode }}&sort=name"
           class="filter-link {% if current_sort == 'name' %}active{% endif %}"
           hx-get="/products/search?category={{ current_category | urlencode }}&sort=name"
           hx-target="#search-results">Name A–Z</a>
    </aside>

    <div class="catalog-main">
        <div id="search-results" class="product-grid">
            {% for p in products %}
            <div class="product-card">
                <a href="/products/{{ p.id }}">
                    <div class="product-image">
                        <img src="{{ p.image_url }}" alt="{{ p.name }}" loading="lazy">
                    </div>
                    <div class="product-info">
                        <span class="product-category">{{ p.category }}</span>
                        <h3>{{ p.name }}</h3>
                        <p class="product-price">${{ p.price | round(precision=2) }}</p>
                    </div>
                </a>
                <button class="btn btn-primary btn-add-cart"
                    hx-post="/api/cart/add"
                    hx-vals='{"product_id":"{{ p.id }}","quantity":"1"}'
                    hx-target="#cart-count"
                    hx-swap="innerHTML"
                    hx-indicator=".htmx-indicator">
                    Add to Cart
                </button>
            </div>
            {% endfor %}
            {% if products | length == 0 %}
            <div class="no-results"><p>No products found.</p></div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
